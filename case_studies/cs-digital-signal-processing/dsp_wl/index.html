
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Compositional system analysis and design using contracts.">
      
      
      
        <link rel="canonical" href="https://www.pacti.org/case_studies/cs-digital-signal-processing/dsp_wl/">
      
      
        <link rel="prev" href="../../cs-biocircuits/specification_based_synthetic_biology/">
      
      
        <link rel="next" href="../../cs-uav-topologies/topologies/">
      
      
      <link rel="icon" href="../../../pacti_small_icon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.2.8">
    
    
      
        <title>Signal Processing in Digital ICs - Pacti</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Libre Baskerville";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/material.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-27G2PM6M65"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-27G2PM6M65",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-27G2PM6M65",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine base classes -->


  


<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >

    <!-- Link to home -->
    <a
      href="../../.."
      title="Pacti"
      class="md-header__button md-logo"
      aria-label="Pacti"
      data-md-component="logo"
    >
      
  <img src="../../../logos/pacti_colorful.svg" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Navigation tabs (sticky) -->
    
    
        
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Case Studies

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../iocontract/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../contributing/" class="md-tabs__link">
          
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
    

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette -->
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/pacti-org/pacti" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    
  </div>
</a>
      </div>
    
  </nav>

</header>

    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pacti" class="md-nav__button md-logo" aria-label="Pacti" data-md-component="logo">
      
  <img src="../../../logos/pacti_colorful.svg" alt="logo">

    </a>
  </label>
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        
          <label class="md-nav__link nav_heading " for="__nav_1" id="__nav_1_label" tabindex="0">
            Home
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/" class="md-nav__link">
        Installing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        
          <label class="md-nav__link nav_heading " for="__nav_2" id="__nav_2_label" tabindex="0">
            Case Studies
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Case Studies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-vehicle-perception/evaluate_perception/" class="md-nav__link">
        Autonomous Systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-multiagent-planning/multiagent/" class="md-nav__link">
        Multi-agent Coordination
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-biocircuits/specification_based_synthetic_biology/" class="md-nav__link">
        Synthetic Biology
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Signal Processing in Digital ICs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Signal Processing in Digital ICs
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preliminaries" class="md-nav__link">
    Preliminaries
  </a>
  
    <nav class="md-nav" aria-label="Preliminaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation-of-fixed-point-number" class="md-nav__link">
    Representation of Fixed-point Number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-sources-in-fixed-point-arithmetic" class="md-nav__link">
    Error Sources in Fixed-point Arithmetic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forming-contract-for-capturing-error-of-fixed-point-number" class="md-nav__link">
    Forming contract for capturing error of fixed-point number
  </a>
  
    <nav class="md-nav" aria-label="Forming contract for capturing error of fixed-point number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeling-of-error-from-operations" class="md-nav__link">
    Modeling of Error from Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation-error-modeling" class="md-nav__link">
    Operation Error Modeling
  </a>
  
    <nav class="md-nav" aria-label="Operation Error Modeling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1-identical-number-of-bits-in-integer-part" class="md-nav__link">
    Case 1: Identical Number of Bits in Integer Part
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-different-number-of-bits-in-integer-part" class="md-nav__link">
    Case 2. Different Number of Bits in Integer Part
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ideal-output-wordlength" class="md-nav__link">
    Ideal Output Wordlength
  </a>
  
    <nav class="md-nav" aria-label="Ideal Output Wordlength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiplication" class="md-nav__link">
    Multiplication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error" class="md-nav__link">
    Propagation of Error
  </a>
  
    <nav class="md-nav" aria-label="Propagation of Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-operation" class="md-nav__link">
    General Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error-in-addition" class="md-nav__link">
    Propagation of Error in Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error-in-multiplication" class="md-nav__link">
    Propagation of Error in Multiplication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-formulation" class="md-nav__link">
    Contract Formulation
  </a>
  
    <nav class="md-nav" aria-label="Contract Formulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ports-in-contract" class="md-nav__link">
    Ports in Contract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assumption" class="md-nav__link">
    Assumption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guarantee" class="md-nav__link">
    Guarantee
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-filter-design" class="md-nav__link">
    Example 2: Filter Design
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-uav-topologies/topologies/" class="md-nav__link">
        UAV Topologies
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        
          <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            Space Mission Scenario
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Space Mission Scenario
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission_power/" class="md-nav__link">
        Power Viewpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission_science/" class="md-nav__link">
        Science & Communication Viewpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission_navigation/" class="md-nav__link">
        Navigation Viewpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission_thermal/" class="md-nav__link">
        Thermal Viewpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/space_mission_3viewpoints/" class="md-nav__link">
        Schedulability Analysis with 3 Viewpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_7" >
      
      
      
        
          <label class="md-nav__link " for="__nav_2_7_7" id="__nav_2_7_7_label" tabindex="0">
            Benchmarks for scenario generation
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7_7">
          <span class="md-nav__icon md-icon"></span>
          Benchmarks for scenario generation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/scenario_generation_5steps/" class="md-nav__link">
        Short scenario generation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/scenario_generation_20steps/" class="md-nav__link">
        Long scenario generation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_8" >
      
      
      
        
          <label class="md-nav__link " for="__nav_2_7_8" id="__nav_2_7_8_label" tabindex="0">
            Benchmarks for schedulability analysis of generated scenarios
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7_8">
          <span class="md-nav__icon md-icon"></span>
          Benchmarks for schedulability analysis of generated scenarios
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/schedulability_analysis_5steps/" class="md-nav__link">
        Short scenario schedulability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/schedulability_analysis_20steps/" class="md-nav__link">
        Long scenario schedulability
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_9" >
      
      
      
        
          <label class="md-nav__link " for="__nav_2_7_9" id="__nav_2_7_9_label" tabindex="0">
            Visualization of schedulable combinations
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7_9">
          <span class="md-nav__icon md-icon"></span>
          Visualization of schedulable combinations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/analysis_results1-5steps/" class="md-nav__link">
        Short scenario & requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/space_mission/analysis_results1-20steps/" class="md-nav__link">
        Long scenario & requirements
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs-space-mission/mars_entry_descent_landing/mars_edl_2nd_encoding/" class="md-nav__link">
        Mars 2020 Entry-Descent-Landing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        
          <label class="md-nav__link nav_heading " for="__nav_3" id="__nav_3_label" tabindex="0">
            API
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../iocontract/" class="md-nav__link">
        IoContract
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Polyhedral/" class="md-nav__link">
        PolyhedralTerms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../smt/" class="md-nav__link">
        SmtTems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../polyhedral-contracts/" class="md-nav__link">
        PolyhedralContracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../smt-contracts/" class="md-nav__link">
        SmtContracts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        
          <label class="md-nav__link nav_heading " for="__nav_4" id="__nav_4_label" tabindex="0">
            Development
            <span class="md-nav__icon md-icon"></span>
          </label>
        
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preliminaries" class="md-nav__link">
    Preliminaries
  </a>
  
    <nav class="md-nav" aria-label="Preliminaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation-of-fixed-point-number" class="md-nav__link">
    Representation of Fixed-point Number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-sources-in-fixed-point-arithmetic" class="md-nav__link">
    Error Sources in Fixed-point Arithmetic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forming-contract-for-capturing-error-of-fixed-point-number" class="md-nav__link">
    Forming contract for capturing error of fixed-point number
  </a>
  
    <nav class="md-nav" aria-label="Forming contract for capturing error of fixed-point number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeling-of-error-from-operations" class="md-nav__link">
    Modeling of Error from Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation-error-modeling" class="md-nav__link">
    Operation Error Modeling
  </a>
  
    <nav class="md-nav" aria-label="Operation Error Modeling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1-identical-number-of-bits-in-integer-part" class="md-nav__link">
    Case 1: Identical Number of Bits in Integer Part
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-different-number-of-bits-in-integer-part" class="md-nav__link">
    Case 2. Different Number of Bits in Integer Part
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ideal-output-wordlength" class="md-nav__link">
    Ideal Output Wordlength
  </a>
  
    <nav class="md-nav" aria-label="Ideal Output Wordlength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiplication" class="md-nav__link">
    Multiplication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error" class="md-nav__link">
    Propagation of Error
  </a>
  
    <nav class="md-nav" aria-label="Propagation of Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-operation" class="md-nav__link">
    General Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error-in-addition" class="md-nav__link">
    Propagation of Error in Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagation-of-error-in-multiplication" class="md-nav__link">
    Propagation of Error in Multiplication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-formulation" class="md-nav__link">
    Contract Formulation
  </a>
  
    <nav class="md-nav" aria-label="Contract Formulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ports-in-contract" class="md-nav__link">
    Ports in Contract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assumption" class="md-nav__link">
    Assumption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guarantee" class="md-nav__link">
    Guarantee
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-filter-design" class="md-nav__link">
    Example 2: Filter Design
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Signal Processing in Digital ICs</h1>

<div><h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>In this case study, we show Pacti can work with a contract-based methodology to aid word-length optimization of digital signal processing integrated circuit design.</p>
<p>A digital signal processing system takes digital signals as inputs and generates the output signals by applying digital filters.
The input signals are usually obtained through an analog-to-digital converter(ADC) from analog signals acquired from the environment by sensors.
The impulse response of the digital filter is a set of coefficients that multiply with the input signals. The result is summed up to get the output signals.</p>
<p>Implementation of a digital filter in hardware is a time-consuming and error-prone process.
To push the power, performance, and area to their limits, the floating-point operations are converted to fixed-point ones to reduce hardware costs and improve efficiency.
However, the conversion incurs challenges, including the risk of overflow and lower accuracy.
As a fixed-point number can represent smaller range than a floating-point one with the same number of bits, overflow might occur after the conversion.
The fixed-point number with fewer bits tends to have lower accuracy as all bits in the fractional parts exceeding its fractional bits have to be discarded.</p>
<p>The following figure shows a multiplication operation using fixed-point numbers.
<img alt="Data_Path" src="https://github.com/pacti-org/media/blob/main/case_studies/digital_signal_processing/digital_data_path_example.png?raw=True"></p>
<p>As a result, verifying and optimizing word length for fixed-point implementation is crucial for integrated circuit implementations.
To prevent overflow and ensure the inaccuracy is acceptable, we need to bound the error of the system given the wordlength. 
In this case study, we apply contracts to compute the bounds of error of fixed-point arithmetic implementation.</p>
<h2 id="preliminaries">Preliminaries<a class="headerlink" href="#preliminaries" title="Permanent link">¶</a></h2>
<p>First, we introduce the fixed-point number.</p>
<h4 id="representation-of-fixed-point-number">Representation of Fixed-point Number<a class="headerlink" href="#representation-of-fixed-point-number" title="Permanent link">¶</a></h4>
<p>A word length of a fixed-point variable <span class="arithmatex">\(x\)</span> can denoted as a tuple <span class="arithmatex">\((x_n, x_p)\)</span>, where <span class="arithmatex">\(x_n\)</span> denotes the number of bits, and <span class="arithmatex">\(x_p\)</span> is number of bits for the integer parts.
For example, a fixed-point number with word length <span class="arithmatex">\((5,2)\)</span> with bit value "11011" means the binary number <span class="arithmatex">\(11.011\)</span>, equivalent to <span class="arithmatex">\(3.375\)</span> in decimal.</p>
<p>First, we import some data structure for holding the wordlength, and the APIs of Pacti.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="sd">"""DSP Case Study Code"""</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tool</span><span class="w"> </span><span class="kn">import</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">float_to_bin</span><span class="p">,</span> <span class="n">port_add</span><span class="p">,</span> <span class="n">port_mult</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pacti.contracts</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolyhedralIoContract</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Definition of value_num method in PortWordLength class</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1">#    def value_num(self):</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1">#        return int(self.value, base=2) * 2 ** (- (self.n - self.p))</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">show_wordlength</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="sd">"""Show the wordlength structure"""</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">port</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"11011"</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'The word length (n = </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s1">, p = </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s1">) of the bits "</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">" is: '</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">port</span><span class="o">.</span><span class="n">value_num</span><span class="p">())</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">show_wordlength</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>The word length (n = 5, p = 2) of the bits "11011" is: 
3.375
</code></pre></div>
<h4 id="error-sources-in-fixed-point-arithmetic">Error Sources in Fixed-point Arithmetic<a class="headerlink" href="#error-sources-in-fixed-point-arithmetic" title="Permanent link">¶</a></h4>
<p>The error of fixed-point arithmetic comes from the following sources:
1. Truncation Errors:
A truncation error occurs when a fixed-point number is converted from a longer representation to a shorter one.
As the number of bits is insufficient to represent the number perfectly, the least significant bits are truncated to match the word length.
Truncation errors occur in fixed-point operations when the word length of the output variable is smaller than the ideal result.
2. Quantization Error:
The quantization error occurs when an analog signal is converted into a digital one or when the coefficients are encoded into digital formats. As a fixed-point number cannot represent any real number with infinite precision, the signals and coefficients have to be quantized, and errors are introduced in the process.
3. Inaccurate Source:
This error comes from the measurement in the analog signal because of noise and non-ideal effect on the sensor and could be seen as a random noise on the analog signal.</p>
<p>The following figure shows the three types of error in the example.
<img alt="Error_Type" src="https://github.com/pacti-org/media/blob/main/case_studies/digital_signal_processing/type_of_error.png?raw=True"></p>
<p>Given a input analog signal, the input signal and filter coefficients are first quantized into fixed-point numbers.
Then the arithmetic operations, based on the algorithm or filter design, are performed on these fixed-point numbers.
The results of the operations are truncated to fit into the fixed-point numbers of the output of the arithmetic operations.</p>
<p>During the process, differences between the fixed-point numbers representation and the ideal numbers result in errors.
These errors propagate through the operations and thus affect the accuracy of the output signal.</p>
<h2 id="forming-contract-for-capturing-error-of-fixed-point-number">Forming contract for capturing error of fixed-point number<a class="headerlink" href="#forming-contract-for-capturing-error-of-fixed-point-number" title="Permanent link">¶</a></h2>
<p>Here we introduce how to form the contract for finding error bounds of the fixed-point number operation.
First, we model the truncation errors and investigate how an operation result in the truncation errors.
Then we consider the propagation of the error in different operations.
We formulate the contract by combining the truncation errors and propagation of the error.</p>
<h4 id="modeling-of-error-from-operations">Modeling of Error from Operations<a class="headerlink" href="#modeling-of-error-from-operations" title="Permanent link">¶</a></h4>
<p>Each operation can be seen as a two-staged process.
First, an ideal output with certain wordlength is generated without losing any accuracy, given the word lengths of all input ports.
Then the ideal output is truncated to the actual output port.
Therefore, the modeling of the ideal output wordlength and the truncation error is required to formulate the contract.</p>
<h4 id="operation-error-modeling">Operation Error Modeling<a class="headerlink" href="#operation-error-modeling" title="Permanent link">¶</a></h4>
<p>In the following, we detail how to model the truncation error.
We divide the truncation error into two cases according to the number of bits for integer part.</p>
<h5 id="case-1-identical-number-of-bits-in-integer-part">Case 1: Identical Number of Bits in Integer Part<a class="headerlink" href="#case-1-identical-number-of-bits-in-integer-part" title="Permanent link">¶</a></h5>
<p>As the integer part has the same number of bits, overflow does not occur in this case. The least significant bits are truncated if the resulting word length is shorter. The maximal truncation error from the word length <span class="arithmatex">\((x_n, x_p)\)</span> to the word length <span class="arithmatex">\((x_n', x_p)\)</span> is <span class="arithmatex">\(2^{x_p}(2^{-x_n'}-2^{-x_n})\)</span>, when <span class="arithmatex">\(x_n &gt; x_n'\)</span>. If <span class="arithmatex">\(x_n &lt; x_n'\)</span>, there is no truncation, and thus the truncation error is exactly <span class="arithmatex">\(0\)</span>.</p>
<p>The following example shows how the error is bounded:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncation_error_same_position</span><span class="p">(</span><span class="n">pi</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">po</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="sd">    Truncation error for the case where input ports and output ports have the same number of integer bits.</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="sd">    Args:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="sd">        pi: PortWordLength: input port word length</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="sd">        po: PortWordLength: input port word length</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="sd">    Returns:</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="sd">        The maximum truncation error if a number is truncated from wordlength pi to wordlength po</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="sd">    """</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="k">assert</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">==</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="k">if</span> <span class="n">pi</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">po</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">po</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">.</span><span class="n">n</span><span class="p">)))</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncate</span><span class="p">(</span><span class="n">pi</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">po</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="sd">    Truncate the value in pi into po.</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="sd">    Args:</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="sd">        pi: PortWordLength: input port word length</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="sd">        po: PortWordLength: input port word length</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="sd">    """</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="c1"># separate the bits into two parts, before binary point and after binary point</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="n">bits_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    <span class="n">bits_before_point</span> <span class="o">=</span> <span class="n">bits_str</span><span class="p">[:</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span><span class="p">]</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>    <span class="n">bits_after_point</span> <span class="o">=</span> <span class="n">bits_str</span><span class="p">[</span><span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="p">:]</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    <span class="c1"># truncate or appending 0</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>        <span class="n">bits_before_point</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span><span class="p">))</span> <span class="o">+</span> <span class="n">bits_before_point</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="n">bits_before_point</span> <span class="o">=</span> <span class="n">bits_before_point</span><span class="p">[</span><span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="p">:]</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>    <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="n">bits_after_point</span> <span class="o">=</span> <span class="n">bits_after_point</span> <span class="o">+</span> <span class="s2">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">po</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>        <span class="n">bits_after_point</span> <span class="o">=</span> <span class="n">bits_after_point</span><span class="p">[:</span> <span class="p">(</span><span class="n">po</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span><span class="p">)]</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>    <span class="c1"># combine the both parts</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">bits_before_point</span> <span class="o">+</span> <span class="n">bits_after_point</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>    <span class="n">po</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ret</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_truncation_error_same_position</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="sd">"""The example showing truncation error for same number of integer bits"""</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"1111111"</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Truncation Error: "</span><span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">truncation_error_same_position</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Example Value to produce the error"</span><span class="p">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="n">truncate</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"p1 = </span><span class="si">{</span><span class="n">p1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">, bits: </span><span class="si">{</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"p2 = </span><span class="si">{</span><span class="n">p2</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">, bits: </span><span class="si">{</span><span class="n">p2</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"p1 - p2 = "</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">value_num</span><span class="p">())</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">example_truncation_error_same_position</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Truncation Error: 
0.09375
Example Value to produce the error
p1 = 3.96875, bits: 1111111
p2 = 3.875, bits: 11111
p1 - p2 =  0.09375
</code></pre></div>
<p>Then let's see what happens if the integer parts have different numbers of bits.</p>
<h5 id="case-2-different-number-of-bits-in-integer-part">Case 2. Different Number of Bits in Integer Part<a class="headerlink" href="#case-2-different-number-of-bits-in-integer-part" title="Permanent link">¶</a></h5>
<p>As the integer parts have different numbers of bits, overflow could occur if the resulting number cannot hold the original integer values.
If an overflow occurs, the result deviates from the ideal value, and thus we expect no overflow occurs during the computation.
This expectation will be applied as the assumption in subsequent parts when we formulate contracts.</p>
<p>Consider the case when converting a variable <span class="arithmatex">\(x\)</span> with word length <span class="arithmatex">\((x_n, x_p)\)</span> to the variable <span class="arithmatex">\(x'\)</span> with word length <span class="arithmatex">\((x_n', x_p')\)</span>.
We have to ensure that the value of <span class="arithmatex">\(x\)</span> does not incur overflow in <span class="arithmatex">\(x'\)</span>.
Therefore, it is reasonable to assume that we know that <span class="arithmatex">\(x\)</span> is bounded by <span class="arithmatex">\(2^{x_p'}\)</span> so that <span class="arithmatex">\(x'\)</span> can represent the number without overflows. </p>
<p>Then, we can ignore the unnecessary most significant bits (<span class="arithmatex">\(x_p - x_p'\)</span>), as they are always <span class="arithmatex">\(0\)</span>s under the assumption.
As a result, <span class="arithmatex">\((x_n, x_p)\)</span> can be seen as <span class="arithmatex">\((x_n - x_p + x_p', x_p')\)</span>. 
The two numbers now have identical numbers of bits in their integer parts, and thus we can apply case 1 to get the truncation errors under the assumption.</p>
<p>The following example shows how the error can be calculated.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncation_error</span><span class="p">(</span><span class="n">pi</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">po</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="sd">    Truncation error for the case where input ports and output ports have different number of integer bits.</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="sd">    Args:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="sd">        pi: PortWordLength: input port word length</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="sd">        po: PortWordLength: input port word length</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="sd">    Returns:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="sd">        The maximum truncation error if a number is truncated from wordlength pi to wordlength po</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="sd">    """</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="c1"># remove uneccesary most significant bits</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="c1"># Remider: The assumption must hold!!</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">pi_adjusted</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">pi</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">po</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="c1"># return the truncation error as in case 1</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="k">return</span> <span class="n">truncation_error_same_position</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">pi_adjusted</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">po</span><span class="p">)</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">po</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="sd">    Compute the assumption required for truncation to ensure no loss of integer values.</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="sd">    Args:</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="sd">        pi: PortWordLength: input port word length</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="sd">        po: PortWordLength: input port word length</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="sd">    Returns:</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="sd">        The maximum bound pi such that it won't loss integer bits after truncation</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="sd">    """</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>    <span class="k">if</span> <span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">po</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">po</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>  <span class="c1"># no additional assumption needed</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">po</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="sd">    Check if the value of the input port satisfy the assumption for truncation.</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="sd">    Args:</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="sd">        pi: PortWordLength: input port word length</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="sd">        po: PortWordLength: input port word length</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="sd">    Returns:</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="sd">        If the assumption to prevent integer bit loss is satisfied</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="sd">    """</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>    <span class="n">assumption_value</span> <span class="o">=</span> <span class="n">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">po</span><span class="p">)</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assumption: </span><span class="si">{</span><span class="n">pi</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">assumption_value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>    <span class="k">if</span> <span class="n">pi</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">assumption_value</span><span class="p">:</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Assumption failed, truncation of MSB occurs"</span><span class="p">)</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assumption Satisfied (</span><span class="si">{</span><span class="n">pi</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">pi</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">assumption_value</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>    <span class="k">return</span> <span class="kc">True</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_truncation_error</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">"""Example showing the truncation error"""</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"0100111"</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="k">assert</span> <span class="n">check_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">p2</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Truncation Error: "</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">truncation_error</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Example Value to produce the error"</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">truncate</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"p1 = </span><span class="si">{</span><span class="n">p1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">, bits: </span><span class="si">{</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"p2 = </span><span class="si">{</span><span class="n">p2</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">, bits: </span><span class="si">{</span><span class="n">p2</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"p1 - p2 = "</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">value_num</span><span class="p">())</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="n">example_truncation_error</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Assumption: p1 &lt; 4.0
Assumption Satisfied (p1 = 2.4375 &lt; 4.0)
Truncation Error: 
0.0625
Example Value to produce the error
p1 = 2.4375, bits: 0100111
p2 = 2.375, bits: 10011
p1 - p2 =  0.0625
</code></pre></div>
<h4 id="ideal-output-wordlength">Ideal Output Wordlength<a class="headerlink" href="#ideal-output-wordlength" title="Permanent link">¶</a></h4>
<p>Now we know how to get the truncation errors given the word length of two numbers, but what is the word length truncated in operations?</p>
<p>Each operation requires a minimum ideal output word length to fully hold the resulting value without losing any information.
Assuming a binary operator, with inputs being <span class="arithmatex">\(x\)</span> and <span class="arithmatex">\(y\)</span> and output being <span class="arithmatex">\(z\)</span>, we represent the ideal output word length using <span class="arithmatex">\((z_n^*, z_p^*)\)</span>.
The ideal output word length is then truncated to fit the output port.</p>
<p>Therefore, we need to know the ideal output word length for the operations.
Let's first examine the addition and then the multiplication.</p>
<h5 id="addition">Addition<a class="headerlink" href="#addition" title="Permanent link">¶</a></h5>
<p>The following equations show the ideal output word length for addition.</p>
<p><span class="arithmatex">\(z_n^* = \max(x_n, y_n - y_p + x_p) + \min(0, x_p - y_p) + 1\)</span>,</p>
<p><span class="arithmatex">\(z_p^* = \max(x_p, y_p) + 1\)</span>.</p>
<p>The rationale behind the equations is to keep every bit from both inputs and include an additional bit for the carry.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_required_word_length_add</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PortWordLength</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="sd">    Compute the minimum word length to hold all values after addition operation on the inputs without lossing any information.</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="sd">    Args:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="sd">    Returns:</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="sd">        The minimum word length to hold all values after addition operation on the inputs without lossing any information.</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">    """</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="n">new_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">in1</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">in2</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">in2</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="n">in1</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">in1</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">in2</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="n">new_p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">in1</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">in2</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="k">return</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">new_n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">new_p</span><span class="p">)</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">error_truncation_add</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="sd">    Compute the maximum error of truncation caused by the addition operation.</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="sd">    The addition operation is perform for ports out = in1 + in2.</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="sd">    The value of in1 + in2 is truncated to fit in out</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="sd">    Args:</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="sd">        out: PortWordLength: output port word length</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="sd">    Returns:</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="sd">        The maximum error of truncation caused by the addition operation</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="sd">    """</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input </span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: (n=</span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input </span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: (n=</span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>    <span class="n">p_ideal</span> <span class="o">=</span> <span class="n">compute_required_word_length_add</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">in1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">in2</span><span class="p">)</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ideal Output: (n=</span><span class="si">{</span><span class="n">p_ideal</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_ideal</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Actual Output (</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">): (n=</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>    <span class="n">assumption_value</span> <span class="o">=</span> <span class="n">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">p_ideal</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assumption: </span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">assumption_value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>    <span class="k">return</span> <span class="n">truncation_error</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">p_ideal</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_truncation_error_add</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="sd">"""Example showing truncation error of addition operation"""</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"0100111"</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">error_truncation_add</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error of the addition calculation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">example_truncation_error_add</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Input p1: (n=7, p=3)
Input p2: (n=5, p=2)
Ideal Output: (n=8, p=4)
Actual Output (p3): (n=5, p=3)
Assumption: p1 + p2 &lt; 8.0
Error of the addition calculation: 0.1875
</code></pre></div>
<h5 id="multiplication">Multiplication<a class="headerlink" href="#multiplication" title="Permanent link">¶</a></h5>
<p>The following equations show the ideal output word length for multiplication.</p>
<p><span class="arithmatex">\(z_n^* = x_n + y_n\)</span>,</p>
<p><span class="arithmatex">\(z_p* = x_p, y_p\)</span>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_required_word_length_mult</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PortWordLength</span><span class="p">:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="sd">    Compute the minimum word length to hold all values after multiplication operation on the inputs without lossing any information.</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="sd">    Args:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">    Returns:</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="sd">        The minimum word length to hold all values after multiplication operation on the inputs without lossing any information.</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="sd">    """</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="n">new_n</span> <span class="o">=</span> <span class="n">in1</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">in2</span><span class="o">.</span><span class="n">n</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="n">new_p</span> <span class="o">=</span> <span class="n">in1</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="n">in2</span><span class="o">.</span><span class="n">p</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="k">return</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">new_n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">new_p</span><span class="p">)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">error_truncation_mult</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="sd">    Compute the maximum error of truncation caused by the multiplication operation.</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="sd">    The multiplication operation is perform for ports out = in1 * in2.</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="sd">    The value of in1 * in2 is truncated to fit in out</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="sd">    Args:</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="sd">        out: PortWordLength: output port word length</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="sd">    Returns:</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="sd">        The maximum error of truncation caused by the multiplication operation</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="sd">    """</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input </span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: (n=</span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input </span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: (n=</span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>    <span class="n">p_ideal</span> <span class="o">=</span> <span class="n">compute_required_word_length_mult</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">in1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">in2</span><span class="p">)</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ideal Output: (n=</span><span class="si">{</span><span class="n">p_ideal</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_ideal</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Actual Output (</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">): (n=</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>    <span class="n">assumption_value</span> <span class="o">=</span> <span class="n">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">p_ideal</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assumption: </span><span class="si">{</span><span class="n">in1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> * </span><span class="si">{</span><span class="n">in2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">assumption_value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="k">return</span> <span class="n">truncation_error</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">p_ideal</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_truncation_error_mult</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">"""Example showing truncation error of multiplication operation"""</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"0100111"</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">error_truncation_mult</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error of the multiplication calculation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="n">example_truncation_error_mult</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Input p1: (n=7, p=3)
Input p2: (n=5, p=2)
Ideal Output: (n=12, p=5)
Actual Output (p3): (n=5, p=3)
Assumption: p1 * p2 &lt; 8.0
Error of the multiplication calculation: 0.2421875
</code></pre></div>
<h4 id="propagation-of-error">Propagation of Error<a class="headerlink" href="#propagation-of-error" title="Permanent link">¶</a></h4>
<p>Since fixed-point arithmetic incurs errors, the error could propagate through the previous operation to the final output.
This error can be seen as independent of truncation error, as truncation errors are applied to the actual input numbers, which already contain the propagation errors.
As a result, the error in the output variable <span class="arithmatex">\(z\)</span>, denoted as <span class="arithmatex">\(z_e\)</span>, can be represented as the sum of the propagation error and the truncation error in the stage: </p>
<p><span class="arithmatex">\(z_e = z_{et} + z_{ep}\)</span>,</p>
<p>where <span class="arithmatex">\(z_{ep}\)</span> is the propagation error from inputs, and <span class="arithmatex">\(z_{et}\)</span> denotes the truncation error occurs in the operation.</p>
<p>Let's now see how the error is propagated in different operations.</p>
<h5 id="general-operation">General Operation<a class="headerlink" href="#general-operation" title="Permanent link">¶</a></h5>
<p>The propagation error is bounded by the maximum differences between the ideal value and the actual values.
Therefore, the propagation errors can be modeled as follows: </p>
<p><span class="arithmatex">\(z_{ep} = \max_{0&lt;=x&lt;=x_a, 0&lt;=y&lt;=y_a}(f(x, y)) - f(x-x_e, y-y_e))\)</span>,</p>
<p>where <span class="arithmatex">\(x_{a}\)</span> and <span class="arithmatex">\(y_{a}\)</span> is the upper bound of input variables <span class="arithmatex">\(x\)</span> and <span class="arithmatex">\(y\)</span>, respectively.</p>
<p>According to this equation, we can derive the propagation error for addition and multiplication operations.</p>
<h5 id="propagation-of-error-in-addition">Propagation of Error in Addition<a class="headerlink" href="#propagation-of-error-in-addition" title="Permanent link">¶</a></h5>
<p>The error is exactly the sum of error from both inputs.
<span class="arithmatex">\(z_{ep} = x_{e} + y_{e}\)</span></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">error_propagation_add</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="sd">    Compute the propagation error caused by addtion operation.</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">    Args:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="sd">        out: PortWordLength: output port word length</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">    Returns:</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">        The propagation error caused by addtion operation given the known error in the inputs.</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="sd">    """</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">in1</span><span class="o">.</span><span class="n">e</span> <span class="o">+</span> <span class="n">in2</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_propagation_error_add</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="sd">"""Example showing propagation error of addition operation"""</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">e1</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">e2</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"0100111"</span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">e_p</span> <span class="o">=</span> <span class="n">error_propagation_add</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">e_t</span> <span class="o">=</span> <span class="n">error_truncation_add</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">e_p</span> <span class="o">+</span> <span class="n">e_t</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Propagation error: </span><span class="si">{</span><span class="n">e_p</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Truncation error: </span><span class="si">{</span><span class="n">e_t</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error bound of the addition calculation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="n">example_propagation_error_add</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Input p1: (n=7, p=3)
Input p2: (n=5, p=2)
Ideal Output: (n=8, p=4)
Actual Output (p3): (n=5, p=3)
Assumption: p1 + p2 &lt; 8.0
Propagation error: 0.7
Truncation error: 0.1875
Error bound of the addition calculation: 0.8875
</code></pre></div>
<h5 id="propagation-of-error-in-multiplication">Propagation of Error in Multiplication<a class="headerlink" href="#propagation-of-error-in-multiplication" title="Permanent link">¶</a></h5>
<p>The error is as follows:</p>
<p><span class="arithmatex">\(z_{ep} = x_{a}*y_{e} + y_{a}*x_{e} - x_{e} * y_{e}\)</span>, </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">error_propagation_mult</span><span class="p">(</span><span class="n">in1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="sd">    Compute the propagation error caused by multiplication operation.</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">    Args:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">        in1: PortWordLength: input port word length</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">        in2: PortWordLength: input port word length</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">        out: PortWordLength: output port word length</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="sd">    Returns:</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="sd">        The propagation error caused by multiplication operation given the known error in the inputs.</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="sd">    """</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">in1</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">in2</span><span class="o">.</span><span class="n">e</span> <span class="o">+</span> <span class="n">in2</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">in1</span><span class="o">.</span><span class="n">e</span> <span class="o">+</span> <span class="n">in1</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">in2</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_propagation_error_mult</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="sd">"""Example showing propagation error of multiplication operation"""</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">e1</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">e2</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"0100111"</span><span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="n">e_p</span> <span class="o">=</span> <span class="n">error_propagation_mult</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="n">e_t</span> <span class="o">=</span> <span class="n">error_truncation_mult</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">e_p</span> <span class="o">+</span> <span class="n">e_t</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Propagation error: </span><span class="si">{</span><span class="n">e_p</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Truncation error: </span><span class="si">{</span><span class="n">e_t</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error bound of the multiplication calculation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="n">example_propagation_error_mult</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Input p1: (n=7, p=3)
Input p2: (n=5, p=2)
Ideal Output: (n=12, p=5)
Actual Output (p3): (n=5, p=3)
Assumption: p1 * p2 &lt; 8.0
Propagation error: 2.81875
Truncation error: 0.2421875
Error bound of the multiplication calculation: 3.0609375
</code></pre></div>
<h4 id="contract-formulation">Contract Formulation<a class="headerlink" href="#contract-formulation" title="Permanent link">¶</a></h4>
<p>We can formulate contracts for each operation by combining the modeling of error bounds from propagation and truncation.
A contract is a pair of an assumption and a guarantee <span class="arithmatex">\(C = (A, G)\)</span>, where <span class="arithmatex">\(C\)</span> represents the contract, <span class="arithmatex">\(A\)</span> denotes its assumption, and <span class="arithmatex">\(G\)</span> is the guarantee.
In the following, we shall introduce the contract formulation for different operations.</p>
<h5 id="ports-in-contract">Ports in Contract<a class="headerlink" href="#ports-in-contract" title="Permanent link">¶</a></h5>
<p>Contracts specify system behaviors by describing the assignment of values in ports. 
For our case study, we see a variable <span class="arithmatex">\(x\)</span> as a combination of two ports: the upper bound value port and the upper bound error port. 
The upper bound value port <span class="arithmatex">\(x_a\)</span> tells the connected component the maximum value the variable can be, and the upper bound error port <span class="arithmatex">\(x_e\)</span>   passes the maximum error to the connected component.</p>
<h5 id="assumption">Assumption<a class="headerlink" href="#assumption" title="Permanent link">¶</a></h5>
<p>The assumption ensures no overflow occurs during the truncation, which has been introduced in the case where truncation involves two variables with different numbers of bits in the integer parts.</p>
<h5 id="guarantee">Guarantee<a class="headerlink" href="#guarantee" title="Permanent link">¶</a></h5>
<p>The guarantee of the contract includes two parts. The first part describes the upper bound value, and the second states the upper bound error.</p>
<p>The following functions show how we form contract for arbitrary length of input ports and output ports.
The "_a" variables are used as the variable for the actual value going through the port.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">form_contract_add</span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">in_port1</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in_port2</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out_port</span><span class="p">:</span> <span class="n">PortWordLength</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="sd">    Create contract in dictionary form for an addition operation.</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="sd">    The contract includes information about the bound for its output value and the bound for its maximum error</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="sd">    Args:</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="sd">        in_port1: PortWordLength: input port word length</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="sd">        in_port2: PortWordLength: input port word length</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="sd">        out_port: PortWordLength: output port word length</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="sd">    Returns:</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="sd">        The contract in dictionary form for an addition operation.</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="sd">    """</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="n">ret_contract</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="c1"># define input/output vars</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"input_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">,</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">,</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>    <span class="p">]</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"output_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">]</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="c1"># get assumption</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>    <span class="n">ideal_out_port</span> <span class="o">=</span> <span class="n">compute_required_word_length_add</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">in_port1</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">in_port2</span><span class="p">)</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>    <span class="n">assumption_value</span> <span class="o">=</span> <span class="n">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">ideal_out_port</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out_port</span><span class="p">)</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>    <span class="c1"># write assumption in the contract</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>    <span class="k">if</span> <span class="n">assumption_value</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">):</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>        <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>        <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>            <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">assumption_value</span><span class="p">}</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>        <span class="p">]</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>    <span class="c1"># get guarantee</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>    <span class="n">e_trunc</span> <span class="o">=</span> <span class="n">truncation_error</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">ideal_out_port</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out_port</span><span class="p">)</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>    <span class="c1"># write guarantee in the contract, note the propagation is encoded in the polyhedral constraints</span>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"guarantees"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>        <span class="p">{</span>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>            <span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>            <span class="s2">"constant"</span><span class="p">:</span> <span class="n">e_trunc</span><span class="p">,</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>        <span class="p">},</span>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">out_port</span><span class="o">.</span><span class="n">a</span><span class="p">},</span>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>        <span class="c1"># {"coefficients":{f"{out_port.name}_a": 1}, "constant":in_port1.a + in_port2.a},</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>    <span class="p">]</span>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>    <span class="k">return</span> <span class="n">ret_contract</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">form_contract_mult_const</span><span class="p">(</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>    <span class="n">in_port</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">in_port_const</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">,</span> <span class="n">out_port</span><span class="p">:</span> <span class="n">PortWordLength</span>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="sd">    Create contract in dictionary form for a constant coefficient multiplication operation.</span>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="sd">    The contract includes information about the bound for its output value and the bound for its maximum error</span>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="sd">    Args:</span>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="sd">        in_port: PortWordLength: input port word length</span>
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a><span class="sd">        in_port_const: PortWordLength: constant input port word length</span>
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a><span class="sd">        out_port: PortWordLength: output port word length</span>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="sd">    Returns:</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a><span class="sd">        The contract in dictionary form for a constant coefficient multiplication operation.</span>
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="sd">    """</span>
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>    <span class="n">ret_contract</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>    <span class="c1"># define input/output vars</span>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"input_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">]</span>
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"output_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">]</span>
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>    <span class="c1"># get assumption</span>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>    <span class="n">ideal_out_port</span> <span class="o">=</span> <span class="n">compute_required_word_length_mult</span><span class="p">(</span><span class="n">in1</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">in2</span><span class="o">=</span><span class="n">in_port_const</span><span class="p">)</span>
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>    <span class="n">assumption_value</span> <span class="o">=</span> <span class="n">get_assumption_value</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">ideal_out_port</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out_port</span><span class="p">)</span>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>    <span class="c1"># write assumption in the contract</span>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>    <span class="k">if</span> <span class="n">assumption_value</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">):</span>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a>        <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">assumption_value</span><span class="p">)</span>
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a>        <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a>            <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="n">in_port_const</span><span class="o">.</span><span class="n">a</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">assumption_value</span><span class="p">}</span>
</span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a>        <span class="p">]</span>
</span><span id="__span-14-83"><a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a>    <span class="c1"># get guarantee</span>
</span><span id="__span-14-84"><a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">ideal_out_port</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
</span><span id="__span-14-85"><a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a>    <span class="n">e_trunc</span> <span class="o">=</span> <span class="n">truncation_error</span><span class="p">(</span><span class="n">pi</span><span class="o">=</span><span class="n">ideal_out_port</span><span class="p">,</span> <span class="n">po</span><span class="o">=</span><span class="n">out_port</span><span class="p">)</span>
</span><span id="__span-14-86"><a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a>
</span><span id="__span-14-87"><a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a>    <span class="c1"># write guarantee in the contract, note the propagation is encoded in the polyhedral constraints</span>
</span><span id="__span-14-88"><a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"guarantees"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-89"><a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a>        <span class="p">{</span>
</span><span id="__span-14-90"><a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a>            <span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-14-91"><a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="o">-</span><span class="n">in_port_const</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">in_port_const</span><span class="o">.</span><span class="n">e</span><span class="p">,</span>
</span><span id="__span-14-92"><a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="o">-</span><span class="n">in_port_const</span><span class="o">.</span><span class="n">e</span><span class="p">,</span>
</span><span id="__span-14-93"><a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-14-94"><a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a>            <span class="p">},</span>
</span><span id="__span-14-95"><a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a>            <span class="s2">"constant"</span><span class="p">:</span> <span class="n">e_trunc</span><span class="p">,</span>
</span><span id="__span-14-96"><a id="__codelineno-14-96" name="__codelineno-14-96" href="#__codelineno-14-96"></a>        <span class="p">},</span>
</span><span id="__span-14-97"><a id="__codelineno-14-97" name="__codelineno-14-97" href="#__codelineno-14-97"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">out_port</span><span class="o">.</span><span class="n">a</span><span class="p">},</span>
</span><span id="__span-14-98"><a id="__codelineno-14-98" name="__codelineno-14-98" href="#__codelineno-14-98"></a>        <span class="c1"># {"coefficients":{f"{out_port.name}_a": 1}, "constant":in_port_const.a * in_port.a},</span>
</span><span id="__span-14-99"><a id="__codelineno-14-99" name="__codelineno-14-99" href="#__codelineno-14-99"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">out_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="o">-</span><span class="n">in_port_const</span><span class="o">.</span><span class="n">a</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="__span-14-100"><a id="__codelineno-14-100" name="__codelineno-14-100" href="#__codelineno-14-100"></a>    <span class="p">]</span>
</span><span id="__span-14-101"><a id="__codelineno-14-101" name="__codelineno-14-101" href="#__codelineno-14-101"></a>    <span class="k">return</span> <span class="n">ret_contract</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_contract_formulation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="sd">"""Example of contract formulation"""</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">c1</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contract1</span><span class="p">))</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">e5</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p4"</span><span class="p">)</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    <span class="n">p5</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">e5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"11011"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p5"</span><span class="p">)</span>  <span class="c1"># const</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    <span class="n">p6</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p6"</span><span class="p">)</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="n">c2</span> <span class="o">=</span> <span class="n">form_contract_mult_const</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p4</span><span class="p">,</span> <span class="n">in_port_const</span><span class="o">=</span><span class="n">p5</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p6</span><span class="p">)</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contract2</span><span class="p">))</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="n">example_contract_formulation</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>{'input_vars': ['p1_a', 'p1_e', 'p2_a', 'p2_e'], 'output_vars': ['p3_a', 'p3_e'], 'assumptions': [{'coefficients': {'p1_a': 1, 'p2_a': 1}, 'constant': 8.0}], 'guarantees': [{'coefficients': {'p1_e': -1, 'p2_e': -1, 'p3_e': 1}, 'constant': 0.1875}, {'coefficients': {'p3_a': 1}, 'constant': 7.75}, {'coefficients': {'p3_a': 1, 'p1_a': -1, 'p2_a': -1}, 'constant': 0}]}
InVars: [p1_a, p1_e, p2_a, p2_e]
OutVars:[p3_a, p3_e]
A: [
  p1_a + p2_a &lt;= 8
]
G: [
  -p1_e - p2_e + p3_e &lt;= 0.1875
  p3_a &lt;= 7.75
  -p1_a - p2_a + p3_a &lt;= 0
]
8.0
Port: , (n, p) = (12, 5), e = 0, a = 31.9921875
InVars: [p4_a, p4_e]
OutVars:[p6_a, p6_e]
A: [
  3.375 p4_a &lt;= 8
]
G: [
  -0.03 p4_a - 3.345 p4_e + p6_e &lt;= 0.2422
  p6_a &lt;= 7.75
  -3.375 p4_a + p6_a &lt;= 0
]
</code></pre></div>
<h4 id="example-1">Example 1<a class="headerlink" href="#example-1" title="Permanent link">¶</a></h4>
<p>Consider the following simple system with two adders.</p>
<p><img alt="Example 1" src="https://github.com/pacti-org/media/blob/main/case_studies/digital_signal_processing/example1.png?raw=True"></p>
<p>The word length is labeled beside the variable. 
We will show how Pacti can be applied to get the error bound for the word length.</p>
<p>First, we express each port using the PortWordLength class, and then form the contracts for the operations.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_example1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="sd">    Generate the example contracts and ports for the example</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="sd">    Returns:</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="sd">        A tuple with 2 elements. The first one is the list of contract, and the other is the list of ports</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="sd">    """</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">c1</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p4"</span><span class="p">)</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="n">p5</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p5"</span><span class="p">)</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="n">c2</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">p3</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">p4</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p5</span><span class="p">)</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>    <span class="n">contracts</span> <span class="o">=</span> <span class="p">[</span><span class="n">contract1</span><span class="p">,</span> <span class="n">contract2</span><span class="p">]</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>    <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span><span class="p">]</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>    <span class="k">return</span> <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span>
</span></code></pre></div>
<p>We then use the composition to get the contract of the two adders.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_composition_two_adder</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="sd">"""Example of showing composition of two adder contracts"""</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">create_example1</span><span class="p">()</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Contract 1:</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">contract1</span><span class="p">))</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Contract 2:</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">contract2</span><span class="p">))</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract2</span><span class="p">)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Contract Sys:</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">contract_sys</span><span class="p">))</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="n">example_composition_two_adder</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Contract 1:
InVars: [p1_a, p1_e, p2_a, p2_e]
OutVars:[p3_a, p3_e]
A: [
  p1_a + p2_a &lt;= 8
]
G: [
  -p1_e - p2_e + p3_e &lt;= 0.125
  p3_a &lt;= 7.75
  -p1_a - p2_a + p3_a &lt;= 0
]
Contract 2:
InVars: [p3_a, p3_e, p4_a, p4_e]
OutVars:[p5_a, p5_e]
A: [
  p3_a + p4_a &lt;= 8
]
G: [
  -p3_e - p4_e + p5_e &lt;= 0.0625
  p5_a &lt;= 7.875
  -p3_a - p4_a + p5_a &lt;= 0
]
Contract Sys:
InVars: [p1_a, p1_e, p2_a, p2_e, p4_a, p4_e]
OutVars:[p5_a, p5_e]
A: [
  p4_a &lt;= 0.25
  p1_a + p2_a &lt;= 8
]
G: [
  -p1_e - p2_e - p4_e + p5_e &lt;= 0.1875
  -p4_a + p5_a &lt;= 7.75
  -p1_a - p2_a - p4_a + p5_a &lt;= 0
  p5_a &lt;= 7.875
]
</code></pre></div>
<p>The composed contract shows the upper bound value and upper bound error of the output using the upper bound value and upper bound error of the inputs.</p>
<p>As we know the input word length, we can encode the input contracts with the upper bound value and upper bound error of the inputs.
Let's see what will happen to the composition if we compose the contracts with the input contracts.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="p">:</span> <span class="n">PortWordLength</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="sd">    Create contract in dictionary form for a input port to the system.</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="sd">    The contract includes information about the bound for its output value and the bound for its maximum error</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="sd">    Args:</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="sd">        in_port: PortWordLength: input port word length</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="sd">    Returns:</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="sd">        The contract in dictionary form for a input port to the system.</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="sd">    """</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">ret_contract</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="c1"># define input/output vars</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"input_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"output_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">]</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="c1"># get assumption</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"guarantees"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">in_port</span><span class="o">.</span><span class="n">a</span><span class="p">},</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_a"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="n">in_port</span><span class="o">.</span><span class="n">e</span><span class="p">},</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="p">{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">in_port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_e"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="o">-</span><span class="n">in_port</span><span class="o">.</span><span class="n">e</span><span class="p">},</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="p">]</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>    <span class="k">return</span> <span class="n">ret_contract</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">composition_with_inputs</span><span class="p">(</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="n">contracts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PolyhedralIoContract</span><span class="p">],</span> <span class="n">ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortWordLength</span><span class="p">]</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PolyhedralIoContract</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="sd">    Composition of the two adder system considering input infomation</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="sd">    Args:</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="sd">        contracts: list of PolyhedralIoContract for the adders</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="sd">        ports: list of port wordlengths for the ports</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="sd">    Returns:</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="sd">        The composition result if the composition is valid</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="sd">    """</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    <span class="n">c_p1</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>    <span class="n">c_p2</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p2</span><span class="p">)</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>    <span class="n">c_p4</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p4</span><span class="p">)</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>    <span class="n">contract_p1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p1</span><span class="p">)</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>    <span class="n">contract_p2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p2</span><span class="p">)</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>    <span class="n">contract_p4</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p4</span><span class="p">)</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>    <span class="c1"># compose the system</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>        <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract2</span><span class="p">)</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Composition Error"</span><span class="p">)</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>        <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract_p1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract_sys</span><span class="p">)</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Composition Error"</span><span class="p">)</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>        <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract_p2</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract_sys</span><span class="p">)</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Composition Error"</span><span class="p">)</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a>        <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract_p4</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract_sys</span><span class="p">)</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Composition Error"</span><span class="p">)</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Contract Sys:</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">contract_sys</span><span class="p">))</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>    <span class="k">return</span> <span class="n">contract_sys</span>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_composition_without_input_bounds</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a><span class="w">    </span><span class="sd">"""Example of composition without input bounds"""</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>    <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">create_example1</span><span class="p">()</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>    <span class="n">composition_with_inputs</span><span class="p">(</span><span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a><span class="n">example_composition_without_input_bounds</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Composition Error
Could not eliminate variables ['p2_a', 'p2_e', 'p5_a', 'p5_e']
by refining the assumptions 
[
  p2_a &lt;= 4.125
]
using guarantees 
[
  p2_a &lt;= 7.75
  -p2_a &lt;= 0
  p2_e = 0
]
</code></pre></div>
<p>Then we consider the case where additional upper bound constraints are known for the inputs:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_composition_with_input_bounds</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="sd">"""Example of composition with correct input bounds"""</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">create_example1</span><span class="p">()</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="n">p1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"10000"</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="n">p2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"01111"</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    <span class="n">p4</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"0000001"</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    <span class="n">composition_with_inputs</span><span class="p">(</span><span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">example_composition_with_input_bounds</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Contract Sys:
InVars: []
OutVars:[p5_a, p5_e]
A: [

]
G: [
  p5_a &lt;= 5.812
  p5_e &lt;= 0.1875
]
</code></pre></div>
<p>In this case, we set the upper bound value of <span class="arithmatex">\(P_1\)</span> to be <span class="arithmatex">\(4\)</span>, <span class="arithmatex">\(P_2\)</span> to be <span class="arithmatex">\(3.75\)</span>, and <span class="arithmatex">\(P_4\)</span> to be <span class="arithmatex">\(0.0625\)</span>. 
Under these input constraints, the operation is compatible with the inputs.  And we obtain the composition results, which show the upper bound value and upper bound error of the output. </p>
<p>We can utilize Pacti to perform local optimization on word lengths.
Given the system specification as a contract, word length optimization aims to reduce the word length while ensuring that the resulting implementation meets the system specification.
Quotient is a contract operation that allows us to break down specifications to a certain subsystem.
In this example, we try to reduce the word length of <span class="arithmatex">\(P_3\)</span>.</p>
<p><img alt="Example 1" src="https://github.com/pacti-org/media/blob/main/case_studies/digital_signal_processing/example1.png?raw=True"></p>
<p>Since the word length of a variable affects the contract of operations that directly produce or use the variable, we can consider a subsystem consisting of those operations. For <span class="arithmatex">\(P_3\)</span>, the subsystem will be the composition of the two adders.</p>
<p>Assume our system specification is as follows:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>A: True
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>G: 1*p5_e &lt;= 0.1,
</span></code></pre></div>
which requires the upper bound error of the output <span class="arithmatex">\(P_5\)</span> to be smaller than 0.1.
<p>We can invoke Pacti to compute the quotient to get the subsystem contract:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_desired_system_contract</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PolyhedralIoContract</span><span class="p">:</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="sd">    Generate contracts for the top-level specification</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="sd">    Returns:</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="sd">        The top-level specification contract</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="sd">    """</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="n">ret_contract</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"input_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"output_vars"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"p5_a"</span><span class="p">,</span> <span class="s2">"p5_e"</span><span class="p">]</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"assumptions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    <span class="n">ret_contract</span><span class="p">[</span><span class="s2">"guarantees"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"coefficients"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"p5_e"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">"constant"</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}]</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    <span class="k">return</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ret_contract</span><span class="p">)</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_show_top_level_spec</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span><span class="sd">"""Example of showing the top level specification"""</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    <span class="n">contract_spec</span> <span class="o">=</span> <span class="n">get_desired_system_contract</span><span class="p">()</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Top Level Specification:"</span><span class="p">)</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contract_spec</span><span class="p">))</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="n">example_show_top_level_spec</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Top Level Specification:
InVars: []
OutVars:[p5_a, p5_e]
A: [

]
G: [
  p5_e &lt;= 0.1
]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">quotient_example1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PolyhedralIoContract</span><span class="p">:</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="sd">    Generate quotient based on the top-level specification and the system.</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="sd">    Returns:</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="sd">        The quotient result, the contract for the two adder operations</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="sd">    """</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="n">contract_spec</span> <span class="o">=</span> <span class="n">get_desired_system_contract</span><span class="p">()</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">create_example1</span><span class="p">()</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">ports</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">p1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"10000"</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    <span class="n">p2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"01111"</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="n">p4</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"0000001"</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="n">c_p1</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="n">c_p2</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p2</span><span class="p">)</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    <span class="n">c_p4</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">p4</span><span class="p">)</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    <span class="n">contract_p1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p1</span><span class="p">)</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    <span class="n">contract_p2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p2</span><span class="p">)</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    <span class="n">contract_p4</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c_p4</span><span class="p">)</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>    <span class="n">tmp_c1</span> <span class="o">=</span> <span class="n">contract_spec</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">contract_p1</span><span class="p">)</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>    <span class="n">tmp_c2</span> <span class="o">=</span> <span class="n">tmp_c1</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">contract_p2</span><span class="p">)</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>    <span class="k">return</span> <span class="n">tmp_c2</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">contract_p4</span><span class="p">)</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_quotient</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">    </span><span class="sd">"""Example of showing using quotient to get contracts for the two adder operations"""</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>    <span class="n">quotient_ret</span> <span class="o">=</span> <span class="n">quotient_example1</span><span class="p">()</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Quotient of the Spec:"</span><span class="p">)</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">quotient_ret</span><span class="p">))</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="n">example_quotient</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Quotient of the Spec:
InVars: [p1_a, p1_e, p2_a, p2_e, p4_a, p4_e]
OutVars:[p5_a, p5_e]
A: [
  p1_a &lt;= 2
  -p1_a &lt;= 0
  p1_e = 0
  p2_a &lt;= 3.75
  -p2_a &lt;= 0
  p2_e = 0
  p4_a &lt;= 0.0625
  -p4_a &lt;= 0
  p4_e = 0
]
G: [
  p5_e &lt;= 0.1
]
</code></pre></div>
<p>The above contracts show the specification for the subsystem of two adders to meet such that the system contract can be implemented correctly. 
The refinement operation checks whether the selected word length meets the subsystem contract.
This way of breaking down contracts into a subsystem allows us to reduce the problem size of the optimization.
We can find the word length that satisfies the subsystem contracts for the two adders without considering the input constraints.
As a result, we perform an exhaustive search to find the word length that meets the subsystem contract and, therefore, the system contract.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_example1_by_p3</span><span class="p">(</span><span class="n">p3_n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">p3_p</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="sd">    Generate the example contracts and ports for the example, given different wordlength of p3</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="sd">    Args:</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="sd">        p3_n: the integer which defines the wordlength n for p3</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="sd">        p3_p: the integer which defines the wordlength p for p3</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="sd">    Returns:</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="sd">        A tuple with 2 elements. The first one is the list of contract, and the other is the list of ports</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="sd">    """</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p1"</span><span class="p">)</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p2"</span><span class="p">)</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">p3_n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p3_p</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p3"</span><span class="p">)</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    <span class="n">c1</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p3</span><span class="p">)</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p4"</span><span class="p">)</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    <span class="n">p5</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"p5"</span><span class="p">)</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>    <span class="n">c2</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">p3</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">p4</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">p5</span><span class="p">)</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>    <span class="n">p1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"10000"</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>    <span class="n">p2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"01111"</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    <span class="n">p4</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">"0000000"</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>    <span class="c1"># print("Contract 1:\n" + str(contract1))</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>    <span class="c1"># print("Contract 2:\n" + str(contract2))</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>    <span class="n">contracts</span> <span class="o">=</span> <span class="p">[</span><span class="n">contract1</span><span class="p">,</span> <span class="n">contract2</span><span class="p">]</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>    <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span><span class="p">]</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>    <span class="k">return</span> <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="k">def</span><span class="w"> </span><span class="nf">exhaustive_search</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="sd">    Perform exhaustive search on finding the minimum wordlength that satisfy the top-level specification</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="sd">    Returns:</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="sd">        The word length n for p3</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="sd">    """</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>    <span class="n">quotient_ret</span> <span class="o">=</span> <span class="n">quotient_example1</span><span class="p">()</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>        <span class="c1"># print(n)</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># keep the same number of bits (2) before binary point</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>        <span class="n">contracts</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">create_example1_by_p3</span><span class="p">(</span><span class="n">p3_n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">p3_p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>        <span class="n">contract1</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>        <span class="n">contract2</span> <span class="o">=</span> <span class="n">contracts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>            <span class="n">contract_sys</span> <span class="o">=</span> <span class="n">contract1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract2</span><span class="p">)</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a>            <span class="c1"># contract_sys = compose_all(contract1, contract2, p1, p2, p3, p4, p5)</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a>            <span class="c1"># print(str(contract_sys))</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>            <span class="k">continue</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a>        <span class="k">if</span> <span class="n">contract_sys</span><span class="o">.</span><span class="n">refines</span><span class="p">(</span><span class="n">quotient_ret</span><span class="p">):</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a>    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_word_length_optimization</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="w">    </span><span class="sd">"""Example of showing word length optimization on p3 for the case study"""</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">exhaustive_search</span><span class="p">()</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Wordlength for P3 to satisfy the spec is n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="n">example_word_length_optimization</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Wordlength for P3 to satisfy the spec is n = 6
</code></pre></div>
<p>And we successfully find the word length of 6 that meets the system specification.</p>
<h4 id="example-2-filter-design">Example 2: Filter Design<a class="headerlink" href="#example-2-filter-design" title="Permanent link">¶</a></h4>
<p>Now we apply the contract to a simple filter that computes the moving average of the input signal, as shown in the figure below,</p>
<p><img alt="Example2" src="https://github.com/pacti-org/media/blob/main/case_studies/digital_signal_processing/digital_filter_flow.png?raw=True"></p>
<p>, where the coefficient is <span class="arithmatex">\(a = 0.2\)</span>, <span class="arithmatex">\(b = 0.6\)</span>, and <span class="arithmatex">\(c = 0.2\)</span>.
Therefore, $y[n] = 0.2 \times x[n-2] + 0.6 \times x[n-1] + 0.2 \times x[n] $.</p>
<p>Assume the word lengths of all variables in the system are (6, 0).
We can obtain the upper bound error of the output as the previous example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example2_filter_design</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="sd">"""Example showing the composition of the filter design"""</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="n">in1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in1"</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">in2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in2"</span><span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">in3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in3"</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="n">const1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const1"</span><span class="p">)</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="n">const2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const2"</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="n">const3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const3"</span><span class="p">)</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    <span class="n">mult_out1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out1"</span><span class="p">)</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="n">mult_out2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out2"</span><span class="p">)</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="n">mult_out3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out3"</span><span class="p">)</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="n">add_out1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"add_out1"</span><span class="p">)</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="n">add_out2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"add_out2"</span><span class="p">)</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>    <span class="n">c</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>    <span class="n">const1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">const1</span><span class="p">)</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>    <span class="n">const2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">const2</span><span class="p">)</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>    <span class="n">const3</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">const3</span><span class="p">)</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>    <span class="n">const1</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">const1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="n">const2</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">const2</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>    <span class="n">const3</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">const3</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"truncated coefficient: </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">const1</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"truncated coefficient: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">const2</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"truncated coefficient: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">const3</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="n">c1</span> <span class="o">=</span> <span class="n">form_contract_mult_const</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in1</span><span class="p">,</span> <span class="n">in_port_const</span><span class="o">=</span><span class="n">const1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">mult_out1</span><span class="p">)</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>    <span class="n">c2</span> <span class="o">=</span> <span class="n">form_contract_mult_const</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in2</span><span class="p">,</span> <span class="n">in_port_const</span><span class="o">=</span><span class="n">const2</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">mult_out2</span><span class="p">)</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>    <span class="n">c3</span> <span class="o">=</span> <span class="n">form_contract_mult_const</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in3</span><span class="p">,</span> <span class="n">in_port_const</span><span class="o">=</span><span class="n">const3</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">mult_out3</span><span class="p">)</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>    <span class="n">ci1</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in1</span><span class="p">)</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>    <span class="n">ci2</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in2</span><span class="p">)</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>    <span class="n">ci3</span> <span class="o">=</span> <span class="n">form_contract_input</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in3</span><span class="p">)</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>    <span class="n">contract1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>    <span class="n">contract2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>    <span class="n">contract3</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>    <span class="n">contract_i1</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ci1</span><span class="p">)</span>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>    <span class="n">contract_i2</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ci2</span><span class="p">)</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>    <span class="n">contract_i3</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ci3</span><span class="p">)</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>    <span class="n">c4</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">mult_out1</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">mult_out2</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">add_out1</span><span class="p">)</span>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>    <span class="n">c5</span> <span class="o">=</span> <span class="n">form_contract_add</span><span class="p">(</span><span class="n">in_port1</span><span class="o">=</span><span class="n">add_out1</span><span class="p">,</span> <span class="n">in_port2</span><span class="o">=</span><span class="n">mult_out3</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">add_out2</span><span class="p">)</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>    <span class="n">contract4</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c4</span><span class="p">)</span>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>    <span class="n">contract5</span> <span class="o">=</span> <span class="n">PolyhedralIoContract</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">c5</span><span class="p">)</span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_i1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract1</span><span class="p">)</span>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract_i2</span><span class="p">)</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract2</span><span class="p">)</span>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract_i3</span><span class="p">)</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract3</span><span class="p">)</span>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract4</span><span class="p">)</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>    <span class="n">contract_system</span> <span class="o">=</span> <span class="n">contract_system</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">contract5</span><span class="p">)</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contract_system</span><span class="p">))</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a><span class="n">example2_filter_design</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>truncated coefficient: 0.2 to 0.1875
truncated coefficient: 0.6 to 0.59375
truncated coefficient: 0.2 to 0.1875
Port: , (n, p) = (12, 0), e = 0, a = 0.999755859375
Port: , (n, p) = (12, 0), e = 0, a = 0.999755859375
Port: , (n, p) = (12, 0), e = 0, a = 0.999755859375
InVars: []
OutVars:[add_out2_a, add_out2_e]
A: [

]
G: [
  add_out2_e &lt;= 0.0769
  add_out2_a &lt;= 0.9536
]
</code></pre></div>
<p>The result shows that the upper bound error of the output <code>add_out_e</code> is 0.07690.</p>
<p>Note that the upper bound is not tight as we abstract the calculation and consider the worse case truncation error for each operation.
The worst case might not happen in all operations simultaneouly, and thus the bound is pessimistic.
However, a pessimistic bound still allows us to analyze the design.
If the obtained error is smaller than the specification, we can rest assured that the design already satisfies the system specification.</p>
<p>Though it is sufficient for us to efficiently obtain an upper bound and perform optimization to get a better design, we still want to know how tight the bound is.
In the following, we try to enumerate all input combinations to find the actual maximum error:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">example_enumerate_error</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="sd">"""Find the actual bound by enumerating the input combinations"""</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">in1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in1"</span><span class="p">)</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">in2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in2"</span><span class="p">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    <span class="n">in3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"in3"</span><span class="p">)</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="n">const1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const1"</span><span class="p">)</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">const2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const2"</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="n">const3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"const3"</span><span class="p">)</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>    <span class="n">mult_out1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out1"</span><span class="p">)</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="n">mult_out2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out2"</span><span class="p">)</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="n">mult_out3</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mult_out3"</span><span class="p">)</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="n">add_out1</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"add_out1"</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    <span class="n">add_out2</span> <span class="o">=</span> <span class="n">PortWordLength</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"add_out2"</span><span class="p">)</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>    <span class="n">c</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="n">const1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">const1</span><span class="p">)</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>    <span class="n">const2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">const2</span><span class="p">)</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>    <span class="n">const3</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">const3</span><span class="p">)</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>    <span class="n">diff_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>    <span class="n">a_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>    <span class="n">i1_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>    <span class="n">i2_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>    <span class="n">i3_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>    <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">6</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>        <span class="n">i1_float</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">6</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>        <span class="n">in1_a</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">i1_float</span><span class="p">,</span> <span class="n">in1</span><span class="p">)</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>        <span class="n">in1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">in1_a</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        <span class="n">i2_float</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">6</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>        <span class="n">in2_a</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">i2_float</span><span class="p">,</span> <span class="n">in2</span><span class="p">)</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>        <span class="n">in2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">in2_a</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>        <span class="n">i3_float</span> <span class="o">=</span> <span class="n">i3</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">6</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>        <span class="n">in3_a</span> <span class="o">=</span> <span class="n">float_to_bin</span><span class="p">(</span><span class="n">i3_float</span><span class="p">,</span> <span class="n">in3</span><span class="p">)</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>        <span class="n">in3</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">in3_a</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>        <span class="n">port_mult</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">const1</span><span class="p">,</span> <span class="n">mult_out1</span><span class="p">)</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>        <span class="n">port_mult</span><span class="p">(</span><span class="n">in2</span><span class="p">,</span> <span class="n">const2</span><span class="p">,</span> <span class="n">mult_out2</span><span class="p">)</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>        <span class="n">port_mult</span><span class="p">(</span><span class="n">in3</span><span class="p">,</span> <span class="n">const3</span><span class="p">,</span> <span class="n">mult_out3</span><span class="p">)</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>        <span class="n">port_add</span><span class="p">(</span><span class="n">mult_out1</span><span class="p">,</span> <span class="n">mult_out2</span><span class="p">,</span> <span class="n">add_out1</span><span class="p">)</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>        <span class="n">port_add</span><span class="p">(</span><span class="n">add_out1</span><span class="p">,</span> <span class="n">mult_out3</span><span class="p">,</span> <span class="n">add_out2</span><span class="p">)</span>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>        <span class="n">actual_result</span> <span class="o">=</span> <span class="n">add_out2</span><span class="o">.</span><span class="n">value_num</span><span class="p">()</span>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>        <span class="n">ideal_result</span> <span class="o">=</span> <span class="n">i1_float</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">i2_float</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">i3_float</span> <span class="o">*</span> <span class="n">c</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>        <span class="n">diff</span> <span class="o">=</span> <span class="n">ideal_result</span> <span class="o">-</span> <span class="n">actual_result</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a>
</span><span id="__span-26-49"><a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">diff_max</span><span class="p">:</span>
</span><span id="__span-26-50"><a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>            <span class="n">diff_max</span> <span class="o">=</span> <span class="n">diff</span>
</span><span id="__span-26-51"><a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>            <span class="n">i1_max</span> <span class="o">=</span> <span class="n">i1_float</span>
</span><span id="__span-26-52"><a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>            <span class="n">i2_max</span> <span class="o">=</span> <span class="n">i2_float</span>
</span><span id="__span-26-53"><a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>            <span class="n">i3_max</span> <span class="o">=</span> <span class="n">i3_float</span>
</span><span id="__span-26-54"><a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a>        <span class="k">if</span> <span class="n">actual_result</span> <span class="o">&gt;</span> <span class="n">a_max</span><span class="p">:</span>
</span><span id="__span-26-55"><a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a>            <span class="n">a_max</span> <span class="o">=</span> <span class="n">actual_result</span>
</span><span id="__span-26-56"><a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a>
</span><span id="__span-26-57"><a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">diff_max</span><span class="p">,</span> <span class="n">i1_max</span><span class="p">,</span> <span class="n">i2_max</span><span class="p">,</span> <span class="n">i3_max</span><span class="p">,</span> <span class="n">a_max</span><span class="p">)</span>
</span><span id="__span-26-58"><a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a>
</span><span id="__span-26-59"><a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a>
</span><span id="__span-26-60"><a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a><span class="n">example_enumerate_error</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>0.06874999999999998 0.828125 0.890625 0.90625 0.90625
</code></pre></div>
<p>The actual bound is about <span class="arithmatex">\(0.0687\)</span>, which is slightly smaller than our derived bound of <span class="arithmatex">\(0.0769\)</span>.
This verifies that our upper bound error is indeed an upper bound for all input combinations.</p></div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>document.write(new Date().getFullYear())</script> University of Michigan - <a href="#__consent">Change cookie settings</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../../../assets/_markdown_exec_pyodide.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://kit.fontawesome.com/4f533dc5a0.js"></script>
      
    
  </body>
</html>